<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <MocksIntermediateCodeGenPath>$([MSBuild]::MakeRelative($(MSBuildProjectDirectory), $([MSBuild]::NormalizePath('$(IntermediateOutputPath)Mocks/'))))</MocksIntermediateCodeGenPath>
  </PropertyGroup>

  <ItemGroup>
     <Clean Include="$(MocksIntermediateCodeGenPath)*$(DefaultLanguageSourceExtension)" /> 
  </ItemGroup>

  <!-- Because our code fixers are intended to be design-time only, 
       we cannot just include them in the package `analyzer` folder.
       Instead, we have to use an alternative mechanism that only 
       adds them for VS. The chosen hook is to check for the DesignTimeBuild 
       property which is passed by VS to the project when retrieving the 
       analyers to run as part of the design-time build only. -->
  <Target Name="_AddMoqDesignTimeCodeFixes" BeforeTargets="CoreCompile" Condition="'$(DesignTimeBuild)' == 'true'">
    <ItemGroup>
      <!-- CodeFix analyzers should only be added to DTBs since they depend on 
         editor features that are not available from csc/vbc -->
      <Analyzer Include="@(CodeFix)" />
    </ItemGroup>
  </Target>

  <Target Name="_AddMocksToCoreCompile" BeforeTargets="CoreCompile">
    <ItemGroup>
      <Compile Remove="@(Compile)" Condition="$([MSBuild]::ValueOrDefault('%(RelativeDir)', '').StartsWith($(MocksIntermediateCodeGenPath)))" />
      <Compile Include="$(MocksIntermediateCodeGenPath)*$(DefaultLanguageSourceExtension)" />
    </ItemGroup>
  </Target>

</Project>